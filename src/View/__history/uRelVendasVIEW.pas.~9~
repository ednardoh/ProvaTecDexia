unit uRelVendasVIEW;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons, Vcl.ExtCtrls,
  Data.DB, Vcl.Grids, Vcl.DBGrids, Datasnap.Provider, Datasnap.DBClient,
  uVendasControl, uEnumerado, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys, FireDAC.Phys.MSSQL,
  FireDAC.Phys.MSSQLDef, FireDAC.VCLUI.Wait, FireDAC.Stan.Param, FireDAC.DatS,
  FireDAC.DApt.Intf, FireDAC.DApt, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  FireDAC.Phys.ODBCBase, frxClass, frxDBSet;

type
  TfrmRelatorioDeVendas = class(TForm)
    pnl_Top: TPanel;
    btn_Consultar: TBitBtn;
    BitBtn2: TBitBtn;
    btn_Sair: TBitBtn;
    Panel1: TPanel;
    TB_Vendas: TClientDataSet;
    TB_VendasID_VENDA: TIntegerField;
    TB_VendasNUM_VENDA: TIntegerField;
    TB_VendasID_PRODUTO: TIntegerField;
    TB_VendasPRODUTO: TStringField;
    TB_VendasDATA_VENDA: TSQLTimeStampField;
    TB_VendasQUANTIDADE: TIntegerField;
    TB_VendasVALOR_UNITARIO: TFMTBCDField;
    TB_VendasVALOR_TOTAL: TFMTBCDField;
    DSP_Vendas: TDataSetProvider;
    ds_CadVendas: TDataSource;
    DBG_ConsVenda: TDBGrid;
    frxDBDatasetVendas: TfrxDBDataset;
    frxReportVendas: TfrxReport;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btn_ConsultarClick(Sender: TObject);
    procedure btn_SairClick(Sender: TObject);
    procedure BitBtn2Click(Sender: TObject);
  private
    { Private declarations }
    Vendas: TVendasControl;
    ATipo: TAcao;
    procedure ConsultaTodasVendas;
  public
    { Public declarations }
  end;

var
  frmRelatorioDeVendas: TfrmRelatorioDeVendas;

implementation

{$R *.dfm}

procedure TfrmRelatorioDeVendas.BitBtn2Click(Sender: TObject);
var
  sPath: string;
begin
  sPath := ExtractFilePath(Application.ExeName)+'Relatorios\RelVendas.fr3';
  frxReportVendas.LoadFromFile(sPath);
  frxReportVendas.ShowReport();
end;

procedure TfrmRelatorioDeVendas.btn_ConsultarClick(Sender: TObject);
begin
  ConsultaTodasVendas;
end;

procedure TfrmRelatorioDeVendas.btn_SairClick(Sender: TObject);
begin
  close;
end;

procedure TfrmRelatorioDeVendas.ConsultaTodasVendas;
begin
  try
    TB_Vendas.Close;
    Vendas:= TVendasControl.Create;
    DSP_Vendas.DataSet := Vendas.Obter('');
    TB_Vendas.close;
    TB_Vendas.Open;
  finally
    Vendas.Free;
  end;
end;

procedure TfrmRelatorioDeVendas.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
  Action := Cafree;
end;

end.
