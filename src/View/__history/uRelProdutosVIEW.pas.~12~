unit uRelProdutosVIEW;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Datasnap.Provider,
  Datasnap.DBClient, Vcl.Grids, Vcl.DBGrids, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.ExtCtrls, uProdutoControl, uEnumerado, frxClass, frxDBSet,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf,
  FireDAC.Phys.Intf, FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async,
  FireDAC.Phys, FireDAC.Phys.MSSQL, FireDAC.Phys.MSSQLDef, FireDAC.VCLUI.Wait,
  FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf, FireDAC.DApt,
  FireDAC.Comp.DataSet, FireDAC.Comp.Client, FireDAC.Phys.ODBCBase;

type
  TfrmRelatorioDeProdutos = class(TForm)
    pnl_Top: TPanel;
    pnl_Client: TPanel;
    btn_Consultar: TBitBtn;
    BitBtn1: TBitBtn;
    BitBtn2: TBitBtn;
    btn_Sair: TBitBtn;
    DBG_ConsProd: TDBGrid;
    TB_Produtos: TClientDataSet;
    TB_ProdutosID: TIntegerField;
    TB_ProdutosCODIGO_BAR: TStringField;
    TB_ProdutosDESCRICAO: TStringField;
    TB_ProdutosPRECO_COMPRA: TFMTBCDField;
    TB_ProdutosPRECO_VENDA: TFMTBCDField;
    TB_ProdutosQTD_ESTOQUE: TFMTBCDField;
    DSP_Produtos: TDataSetProvider;
    ds_CadProdutos: TDataSource;
    frxDBDatasetProdutos: TfrxDBDataset;
    frxReportProdutos: TfrxReport;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btn_SairClick(Sender: TObject);
    procedure btn_ConsultarClick(Sender: TObject);
    procedure BitBtn2Click(Sender: TObject);
    procedure BitBtn1Click(Sender: TObject);
  private
    { Private declarations }
    Produtos: TProdutoControl;
    ATipo: TAcao;
    procedure ConsultaTodosProdutos;
  public
    { Public declarations }
  end;

var
  frmRelatorioDeProdutos: TfrmRelatorioDeProdutos;

implementation

{$R *.dfm}

procedure TfrmRelatorioDeProdutos.BitBtn1Click(Sender: TObject);
begin
  frxReportProdutos.Print;
end;

procedure TfrmRelatorioDeProdutos.BitBtn2Click(Sender: TObject);
var
  sPath: string;
begin
  sPath := ExtractFilePath(Application.ExeName)+'Relatorios\RelProdutos.fr3';
  frxReportProdutos.LoadFromFile(sPath);
  frxReportProdutos.ShowReport();
end;

procedure TfrmRelatorioDeProdutos.btn_ConsultarClick(Sender: TObject);
begin
  ConsultaTodosProdutos;
end;

procedure TfrmRelatorioDeProdutos.btn_SairClick(Sender: TObject);
begin
  close;
end;

procedure TfrmRelatorioDeProdutos.ConsultaTodosProdutos;
begin
  try
    TB_Produtos.Close;
    Produtos:= TProdutoControl.Create;
    DSP_Produtos.DataSet := Produtos.Obter(1,'');
    TB_Produtos.close;
    TB_Produtos.Open;
  finally
    Produtos.Free;
  end;
end;

procedure TfrmRelatorioDeProdutos.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
  Action := cafree;
end;

end.
